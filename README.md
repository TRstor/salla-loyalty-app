# โญ ุชุทุจูู ููุงุท ุงูููุงุก - ุณูุฉ (Salla Loyalty App)

ุชุทุจูู ูุชูุงูู ูููุตุฉ ุณูุฉ ูููุฑ ูุธุงู ููุงุท ููุงุก ุงุญุชุฑุงูู ููุนููุงุกุ ูุฏุนู ูุณุจ ุงูููุงุท ูุงุณุชุจุฏุงููุง ูุฅุฏุงุฑุฉ ุงููุณุชููุงุช ูุงูุฅุญุงูุงุช.

---

## ๐ ุงููููุฒุงุช

| ุงูููุฒุฉ | ุงููุตู |
|--------|-------|
| โญ **ููุงุท ุชููุงุฆูุฉ** | ูุณุจ ููุงุท ุชููุงุฆูุงู ุนูู ูู ุนูููุฉ ุดุฑุงุก |
| ๐๏ธ **ุงุณุชุจุฏุงู ุจููุจููุงุช** | ุชุญููู ุงูููุงุท ุฅูู ููุจููุงุช ุฎุตู ุชููุดุฃ ูู ุณูุฉ |
| ๐ **ูุณุชููุงุช ุงูุนููุงุก** | ุจุฑููุฒูุ ูุถูุ ุฐูุจูุ ุจูุงุชููู ูุน ูุถุงุนู ููุงุท |
| ๐ค **ูุธุงู ุงูุฅุญุงูุงุช** | ููุฏ ุฅุญุงูุฉ ูุฑูุฏ ููู ุนููู ูุน ููุงูุขุช |
| ๐ **ููุงุท ุชุฑุญูุจูุฉ** | ููุงุท ูุฏูุฉ ุนูุฏ ุงูุชุณุฌูู ุงูุฌุฏูุฏ |
| ๐ **ููุญุฉ ุชุญูู** | ุฅุญุตุงุฆูุงุช ูุฑุณูู ุจูุงููุฉ ุดุงููุฉ ููุชุงุฌุฑ |
| ๐ค **ุตูุญุฉ ุงูุนููู** | ุนุฑุถ ุงูุฑุตูุฏ ูุงูุณุฌู ูุงูุงุณุชุจุฏุงู |
| ๐ **ุชูุงูู ุณูุฉ** | OAuth2 + Webhooks ุชููุงุฆู |

---

## ๐๏ธ ุงูุชูููุงุช

- **Backend:** Node.js, Express.js
- **Frontend:** React.js
- **Database:** PostgreSQL + Prisma ORM
- **Auth:** Salla OAuth2 + JWT
- **Deployment:** Docker + Docker Compose

---

## ๐ ูููู ุงููุดุฑูุน

```
salla-loyalty-app/
โโโ server/                    # ุงูุฎุงุฏู (Backend)
โ   โโโ prisma/
โ   โ   โโโ schema.prisma      # ูููุฐุฌ ูุงุนุฏุฉ ุงูุจูุงูุงุช
โ   โโโ src/
โ   โ   โโโ config/            # ุฅุนุฏุงุฏุงุช ุงูุชุทุจูู
โ   โ   โโโ middlewares/       # Auth middleware
โ   โ   โโโ routes/            # ูุณุงุฑุงุช API
โ   โ   โ   โโโ auth.js        # OAuth2 ูุน ุณูุฉ
โ   โ   โ   โโโ webhooks.js    # ูุนุงูุฌุฉ ุฃุญุฏุงุซ ุณูุฉ
โ   โ   โ   โโโ customer.js    # ุฅุฏุงุฑุฉ ุงูุนููุงุก
โ   โ   โ   โโโ points.js      # ูุนุงููุงุช ุงูููุงุท
โ   โ   โ   โโโ settings.js    # ุฅุนุฏุงุฏุงุช ุงูููุงุก
โ   โ   โ   โโโ tiers.js       # ูุณุชููุงุช ุงูุนููุงุก
โ   โ   โ   โโโ coupons.js     # ููุจููุงุช ุงูุฎุตู
โ   โ   โ   โโโ stats.js       # ุงูุฅุญุตุงุฆูุงุช
โ   โ   โโโ services/          # ุฎุฏูุงุช ุงูููุทู
โ   โ   โโโ index.js           # ููุทุฉ ุงูุจุฏุงูุฉ
โ   โโโ Dockerfile
โโโ client/                    # ุงููุงุฌูุฉ (Frontend)
โ   โโโ public/
โ   โโโ src/
โ   โ   โโโ components/        # ููููุงุช React
โ   โ   โโโ pages/             # ุตูุญุงุช ุงูุชุทุจูู
โ   โ   โโโ services/          # ุฎุฏูุงุช API
โ   โ   โโโ styles/            # ุงูุฃููุงุท
โ   โโโ Dockerfile
โโโ docker-compose.yml
โโโ README.md
```

---

## โก ุงูุชุดุบูู ุงูุณุฑูุน

### 1. ุฅุนุฏุงุฏ ุงููุชุทูุจุงุช

```bash
# ูุณุฎ ูุชุบูุฑุงุช ุงูุจูุฆุฉ
cp server/.env.example server/.env
# ุซู ุนุฏูู ุงูููู ูู server/.env
```

### 2. ุฅุนุฏุงุฏ ุญุณุงุจ ุณูุฉ ูููุทูุฑูู

1. ุณุฌู ูู [Salla Partners](https://salla.partners/)
2. ุฃูุดุฆ ุชุทุจูู ุฌุฏูุฏ
3. ุฃุถู `http://localhost:5000/api/auth/callback` ูู Redirect URI
4. ุฃุถู `http://localhost:5000/api/webhooks` ูู Webhook URL
5. ูุนูู ุงูุฃุญุฏุงุซ: `order.created`, `order.updated`, `customer.created`, `customer.updated`
6. ุงูุณุฎ Client ID ู Client Secret ุฅูู ููู `.env`

### 3. ุงูุชุดุบูู ุจู Docker

```bash
docker-compose up -d
```

### 4. ุงูุชุดุบูู ููุชุทููุฑ

```bash
# ูุงุนุฏุฉ ุงูุจูุงูุงุช
docker-compose up postgres -d

# Backend
cd server
npm install
cp .env.example .env    # ุนุฏูู ุงูููู
npx prisma migrate dev
npm run dev

# Frontend (ูู terminal ุขุฎุฑ)
cd client
npm install
npm start
```

---

## ๐ ุฑูุงุจุท ุงูุชุทุจูู

| ุงูุฑุงุจุท | ุงููุตู |
|--------|-------|
| `http://localhost:3000` | ููุญุฉ ุชุญูู ุงูุชุงุฌุฑ |
| `http://localhost:3000/loyalty/{merchantId}` | ุตูุญุฉ ุงูุนููู |
| `http://localhost:5000/api/health` | ูุญุต ุตุญุฉ ุงูุฎุงุฏู |
| `http://localhost:5000/api/auth/login` | ุจุฏุก OAuth ูุน ุณูุฉ |

---

## ๐ก API Endpoints

### Auth
- `GET /api/auth/login` - ุจุฏุก OAuth
- `GET /api/auth/callback` - Callback ูู ุณูุฉ
- `GET /api/auth/verify` - ุงูุชุญูู ูู ุงูุชููู

### Merchant
- `GET /api/merchant/profile` - ูุนูููุงุช ุงูุชุงุฌุฑ

### Settings
- `GET /api/settings` - ุฌูุจ ุงูุฅุนุฏุงุฏุงุช
- `PUT /api/settings` - ุชุญุฏูุซ ุงูุฅุนุฏุงุฏุงุช

### Customers
- `GET /api/customers` - ูุงุฆูุฉ ุงูุนููุงุก
- `GET /api/customers/:id` - ุชูุงุตูู ุนููู
- `POST /api/customers/auth` - ุชุณุฌูู ุฏุฎูู ุงูุนููู

### Points
- `GET /api/points/transactions` - ุณุฌู ุงููุนุงููุงุช
- `POST /api/points/add` - ุฅุถุงูุฉ ููุงุท ูุฏููุงู
- `POST /api/points/deduct` - ุฎุตู ููุงุท

### Tiers
- `GET /api/tiers` - ูุงุฆูุฉ ุงููุณุชููุงุช
- `POST /api/tiers` - ุฅุถุงูุฉ ูุณุชูู
- `PUT /api/tiers/:id` - ุชุนุฏูู ูุณุชูู
- `DELETE /api/tiers/:id` - ุญุฐู ูุณุชูู

### Coupons
- `GET /api/coupons` - ูุงุฆูุฉ ุงูููุจููุงุช
- `POST /api/coupons/redeem` - ุงุณุชุจุฏุงู ููุงุท ุจููุจูู

### Stats
- `GET /api/stats` - ุฅุญุตุงุฆูุงุช ุนุงูุฉ
- `GET /api/stats/top-customers` - ุฃูุถู ุงูุนููุงุก

### Webhooks
- `POST /api/webhooks` - ุงุณุชูุจุงู ุฃุญุฏุงุซ ุณูุฉ

---

## ๐ ูููุฐุฌ ูุงุนุฏุฉ ุงูุจูุงูุงุช

- **Merchant** - ุงูุชุงุฌุฑ (ูุชุฌุฑ ุณูุฉ)
- **LoyaltySettings** - ุฅุนุฏุงุฏุงุช ุจุฑูุงูุฌ ุงูููุงุก
- **Customer** - ุงูุนููุงุก ูุน ุฑุตูุฏ ุงูููุงุท
- **Tier** - ูุณุชููุงุช ุงูุนููุงุก
- **PointTransaction** - ุณุฌู ูุนุงููุงุช ุงูููุงุท
- **Coupon** - ููุจููุงุช ุงูุฎุตู ุงููููุดุฃุฉ
- **ReferralCode** - ุฃููุงุฏ ุงูุฅุญุงูุฉ

---

## โ๏ธ ุฅุนุฏุงุฏุงุช ุจุฑูุงูุฌ ุงูููุงุก

| ุงูุฅุนุฏุงุฏ | ุงูุงูุชุฑุงุถู | ุงููุตู |
|---------|-----------|-------|
| ููุงุท ููู ุฑูุงู | 1 | ุนุฏุฏ ุงูููุงุท ุงูููุชุณุจุฉ ููู ุฑูุงู |
| ุงูุญุฏ ุงูุฃุฏูู ููุทูุจ | 0 ุฑ.ุณ | ุงูุญุฏ ุงูุฃุฏูู ูุงุญุชุณุงุจ ุงูููุงุท |
| ุตูุงุญูุฉ ุงูููุงุท | 365 ููู | ูุฏุฉ ุตูุงุญูุฉ ุงูููุงุท |
| ููุงุท ููู 1 ุฑ.ุณ ุฎุตู | 100 | ููุงุท ููุงุจู 1 ุฑูุงู ุฎุตู |
| ุงูุญุฏ ุงูุฃุฏูู ููุงุณุชุจุฏุงู | 100 ููุทุฉ | ุฃูู ุนุฏุฏ ููุงุท ููุงุณุชุจุฏุงู |
| ููุงุท ุงูุชุณุฌูู | 50 | ููุงุท ุชุฑุญูุจูุฉ |
| ููุงุท ุงูุฅุญุงูุฉ (ูุญูู) | 100 | ููุงุท ููู ูุญูู |
| ููุงุท ุงูุฅุญุงูุฉ (ูุญุงู) | 50 | ููุงุท ูููุญุงู ุฅููู |

---

## ๐ ุงููุณุชููุงุช ุงูุงูุชุฑุงุถูุฉ

| ุงููุณุชูู | ุงูุญุฏ ุงูุฃุฏูู | ูุถุงุนู ุงูููุงุท | ุงูููู |
|---------|------------|-------------|-------|
| ๐ฅ ุจุฑููุฒู | 0 ููุทุฉ | ร1 | #CD7F32 |
| ๐ฅ ูุถู | 500 ููุทุฉ | ร1.5 | #C0C0C0 |
| ๐ฅ ุฐูุจู | 2,000 ููุทุฉ | ร2 | #FFD700 |
| ๐ ุจูุงุชููู | 5,000 ููุทุฉ | ร3 | #E5E4E2 |

---

## ๐ ุงููุดุฑ ุนูู Render

### ุงูุทุฑููุฉ 1: Blueprint (ุชููุงุฆู)

1. ุงุฑูุน ุงููุดุฑูุน ุนูู GitHub
2. ุงุฐูุจ ุฅูู [Render Dashboard](https://dashboard.render.com/) โ **New** โ **Blueprint**
3. ุงุฑุจุท ุงูุฑูุจู ูุงุฎุชุฑ ูุฑุน `main`
4. Render ุณููุฑุฃ ููู `render.yaml` ูููุดุฆ ุชููุงุฆูุงู:
   - ๐๏ธ ูุงุนุฏุฉ ุจูุงูุงุช PostgreSQL
   - โ๏ธ ุฎุงุฏู API (Web Service)
   - ๐ฅ๏ธ ูุงุฌูุฉ React (Static Site)
5. ุจุนุฏ ุงูุฅูุดุงุกุ ุฃุถู ุงููุชุบูุฑุงุช ุงูุชุงููุฉ ูุฏููุงู:

| ุงูุฎุฏูุฉ | ุงููุชุบูุฑ | ุงููููุฉ |
|--------|---------|--------|
| `salla-loyalty-api` | `SALLA_CLIENT_ID` | ูู ุญุณุงุจ ุดุฑูุงุก ุณูุฉ |
| `salla-loyalty-api` | `SALLA_CLIENT_SECRET` | ูู ุญุณุงุจ ุดุฑูุงุก ุณูุฉ |
| `salla-loyalty-api` | `SALLA_REDIRECT_URI` | `https://salla-loyalty-api.onrender.com/api/auth/callback` |
| `salla-loyalty-api` | `SALLA_WEBHOOK_SECRET` | ูู ุญุณุงุจ ุดุฑูุงุก ุณูุฉ |
| `salla-loyalty-api` | `CLIENT_URL` | `https://salla-loyalty-client.onrender.com` |
| `salla-loyalty-client` | `REACT_APP_API_URL` | `https://salla-loyalty-api.onrender.com/api` |

### ุงูุทุฑููุฉ 2: ูุฏููุงู

#### 1. ูุงุนุฏุฉ ุงูุจูุงูุงุช
- **New** โ **PostgreSQL** โ Plan: Free โ Create

#### 2. ุงูุฎุงุฏู (Backend)
- **New** โ **Web Service** โ ุฑุจุท ุงูุฑูุจู
- **Root Directory:** `server`
- **Build Command:** `npm install && npx prisma generate && npx prisma migrate deploy`
- **Start Command:** `node src/index.js`
- **Environment:** Node
- ุฃุถู ุงููุชุบูุฑุงุช (ุงูุณุฎ `DATABASE_URL` ูู PostgreSQL)

#### 3. ุงููุงุฌูุฉ (Frontend)
- **New** โ **Static Site** โ ุฑุจุท ุงูุฑูุจู
- **Root Directory:** `client`
- **Build Command:** `npm install && npm run build`
- **Publish Directory:** `build`
- ุฃุถู ูุชุบูุฑ `REACT_APP_API_URL` = ุฑุงุจุท ุงูู API
- ุฃุถู **Rewrite Rule:** `/* โ /index.html` (Status: 200)

### โก ุจุนุฏ ุงููุดุฑ

1. ุญุฏูุซ **Redirect URI** ูู ุชุทุจูู ุณูุฉ:
   ```
   https://salla-loyalty-api.onrender.com/api/auth/callback
   ```
2. ุญุฏูุซ **Webhook URL** ูู ุชุทุจูู ุณูุฉ:
   ```
   https://salla-loyalty-api.onrender.com/api/webhooks
   ```
3. ุงูุชุญ `https://salla-loyalty-client.onrender.com` ูุงุจุฏุฃ!

---

## ๐ ุงูุฑุฎุตุฉ

MIT License
